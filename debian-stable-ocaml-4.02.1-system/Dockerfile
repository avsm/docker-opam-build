# OPAM for debian-stable with system OCaml compiler and OpenSUSE PPA
# Autogenerated by OCaml-Dockerfile scripts
FROM avsm/docker-ocaml-build:debian-stable
MAINTAINER Anil Madhavapeddy <anil@recoil.org>
RUN git config --global user.email "docker@example.com"
RUN git config --global user.name "Docker CI"
RUN echo "deb http://download.opensuse.org/repositories/home:/ocaml//Debian_7.0/ /" > /etc/apt/sources.list.d/opam.list
RUN curl -OL http://download.opensuse.org/repositories/home:/ocaml//Debian_7.0/Release.key
RUN apt-key add - < Release.key
RUN apt-get -y update
RUN apt-get -y upgrade
RUN apt-get -y install opam aspcud
RUN echo 'opam ALL=(ALL:ALL) NOPASSWD:ALL' > /etc/sudoers.d/opam
RUN chmod 440 /etc/sudoers.d/opam
RUN chown root:root /etc/sudoers.d/opam
RUN adduser --disabled-password --gecos '' opam
RUN passwd -l opam
RUN chown -R opam:opam /home/opam
USER opam
ENV HOME /home/opam
WORKDIR /home/opam
ENV OPAMYES 1
RUN sudo -u opam sh -c "git clone git://github.com/ocaml/opam-repository"
RUN sudo -u opam sh -c "opam init -a -y /home/opam/opam-repository"
WORKDIR /home/opam/opam-repository
RUN sudo -u opam sh -c "opam install -y opam-installext"
RUN sh -c "cp `opam config var bin`/opam-installext /usr/bin/opam-installext"
ONBUILD RUN sudo -u opam sh -c "cd /home/opam/opam-repository && git pull && opam update -u -y"